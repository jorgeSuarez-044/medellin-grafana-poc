<h2 class="page-title">Ciudad Inteligente - Sensores de ruido</h2>

<div class="iframe-container">
  <iframe
    src="http://grafana-fiware.apps.preprodalcaldia.medellin.gov.co/territoriointeligente/d/sr_ma/ruido-map?orgId=1&from=1739789553128&to=1740394353128&viewPanel=1&kiosk"
    allowfullscreen>
  </iframe>
  <iframe
    src="http://grafana-fiware.apps.preprodalcaldia.medellin.gov.co/territoriointeligente/d/f36b2714-61d2-45cd-91ac-58b622840b4e/sensores-ruido-2025?orgId=1&kiosk"
    allowfullscreen>
  </iframe>
  <h2>Mapa de Sensores</h2>
</div>

  <div class="map-container" >
    <div *ngIf="loading" class="loading-overlay">
      <mat-spinner></mat-spinner>
      <p>Cargando datos de sensores...</p>
    </div>

    <div *ngIf="error" class="error-overlay">
      <mat-icon>error_outline</mat-icon>
      <p>Error al cargar los datos de los sensores</p>
      <button mat-raised-button color="primary" (click)="loadSensorData()">Reintentar</button>
    </div>

    <div class="map-layout">
      <div #map id="noise-sensor-map"></div>

      <div class="details-panel" *ngIf="selectedSensor">
        <div class="panel-header">
          <h3>Detalles del Sensor</h3>
          <button mat-icon-button (click)="closeDetails()">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <div id="sensor-details" class="sensor-details">
          <div class="detail-row">
            <span class="detail-label">ID:</span>
            <span class="detail-value">{{ selectedSensor.id.split(':').pop() }}</span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Nivel de Ruido:</span>
            <span class="detail-value">{{ selectedSensor.laeq }} dB ({{ selectedSensor.levelName }})</span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Última actualización:</span>
            <span class="detail-value">{{ selectedSensor.lastUpdate }}</span>
          </div>

          <!-- Espacio para gráficas si las añades luego -->
          <div class="charts-placeholder">
            <p></p>
          </div>
        </div>
      </div>
    </div>

    <div class="map-legend">
      <h4>Leyenda</h4>
      <div class="legend-item">
        <span class="legend-color low"></span>
        <span>Bajo (<55 dB)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color moderate"></span>
        <span>Moderado (55-70 dB)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color high"></span>
        <span>Alto (>70 dB)</span>
      </div>
    </div>
  </div>

  